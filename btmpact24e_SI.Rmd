---
title: "Supplemental Information"
author: "Anonymized for peer review (NC)"
reviewer: "Anonymized for peer review (JT)"
date: "2024-07-25"
output: word_document
editor_options: 
  chunk_output_type: console
---
This code compiles information for the Supplemental Information

```{r libraries}
# load libraries
library('tidyverse')
library('here')

# specify directory
i_am('btmpact24e_SI.Rmd')

# set plotting theme
theme_set(theme_classic()) 

# turn off scientific notation
options(scipen = 999)
```

# Open combined and processed data
```{r}
# open
DF <- 
  readRDS('data/combined/DF.full.combined.processed.Rds') %>% 
  
  # select relevant variables
  select(id, publication_date, dataset,
         authors.n, size.bin, 
         cited_by_count, news, policy, speed,
         citation.per, news.per, policy.per, speed.per)
```

# Number of papers on each topic
```{r}
DF %>% 
  group_by(dataset) %>% 
  summarise(n = n())
```

# Descriptive statistics
N's, raw M's, raw SD's
```{r}
desc1 <- DF %>% 
  # select relevant variables
  select(dataset, size.bin, 
         cited_by_count : speed) %>% 
  
  # pivot longer to separate outcome and value
  pivot_longer(cited_by_count : speed) %>% 
  
  # calculate summary statistics
  group_by(dataset, name, size.bin) %>% 
  summarise(n = n(),
            m = mean(value, na.rm = T),
            sd = sd(value, na.rm = T)) %>% 
  
  # establish consistent naming
  mutate(name = case_when(
    name == "cited_by_count" ~ "scholarly articles",
    name == "news" ~ "news outputs",
    name == "policy" ~ "policy documents",
    name == "speed" ~ "response time")
    )
```

percentile M's and SD's
```{r}
desc2 <- DF %>% 
  # select relevant variables
  select(dataset, size.bin, 
         citation.per : speed.per) %>% 
  
  # pivot longer to separate outcome and value
  pivot_longer(citation.per : speed.per) %>% 
  
  # calculate summary statistics
  group_by(dataset, name, size.bin) %>% 
  summarise(m.per = mean(value, na.rm = T),
            sd.per = sd(value, na.rm = T)) %>% 
  
  # establish consistent naming
  mutate(name = case_when(
    name == "citation.per" ~ "scholarly articles",
    name == "news.per" ~ "news outputs",
    name == "policy.per" ~ "policy documents",
    name == "speed.per" ~ "response time")
    )
```

Probability of being mentioned
```{r}
desc3 <- DF %>% 
  # calculate probability of being mentioned
  mutate(cite.d = 
           if_else(cited_by_count > 0,
                   1,
                   0),
         news.d = 
           if_else(news > 0,
                   1,
                   0),
         policy.d = 
           if_else(policy > 0,
                   1,
                   0)) %>% 
  
  # select relevant variables
  select(dataset, size.bin, 
         cite.d : policy.d) %>% 
  
  # pivot longer to separate outcome and value
  pivot_longer(cite.d : policy.d) %>% 
  
  # calculate summary statistics
  group_by(dataset, name, size.bin) %>% 
  summarise(m.d = mean(value, na.rm = T),
            sd.d = sd(value, na.rm = T)) %>% 
  
  # establish consistent naming
  mutate(name = case_when(
    name == "cite.d" ~ "scholarly articles",
    name == "news.d" ~ "news outputs",
    name == "policy.d" ~ "policy documents")
    )
```

Join 
```{r}
desc <-
  # join
  left_join(desc1,
            desc2) %>% 
  left_join(desc3) %>% 
  
  # round for ease
  mutate_at(vars(m : sd.d),
            ~round(., 2))
  

# delete vestigial
rm(desc1, desc2, desc3)
```

Export
```{r}
# ai
desc %>% 
  filter(dataset == 'ai') %>% 
  write.csv('writing/supplement/btmpact24e_ai.desc.csv',
            row.names = F)

# terror
desc %>% 
  filter(dataset == 'terror') %>% 
  write.csv('writing/supplement/btmpact24e_terror.desc.csv',
            row.names = F)

# covid
desc %>% 
  filter(dataset == 'covid') %>% 
  write.csv('writing/supplement/btmpact24e_covid.desc.csv',
            row.names = F)
```

# Examination of big teams in research on terrorism
Calculate descriptive statistics
```{r}
# calculate 
desc <-
  DF %>% 
  
  # limit to terrorism papers
  filter(dataset == 'terror') %>% 
  
  # select relevant variables
  select(id, size.bin,
         cited_by_count : speed) %>% 
  
  # pivot longer for easier processing
  pivot_longer(cited_by_count : speed) %>% 
  
  # group
  group_by(size.bin, name) %>% 
  
  # summarise
  summarise(n = sum(!is.na(value)),
            m = mean(value,
                     na.rm = T),
            sd = sd(value,
                    na.rm = T),
            se = sd / sqrt(n)) %>% 
  
  # fix variable names
  mutate(name = 
           case_when(
             name == 'cited_by_count' ~ 'scholarly article mentions',
             name == 'news' ~ 'news output mentions',
             name == 'policy' ~ 'policy document mentions',
             name == 'speed' ~ 'response time'
             )
         ) %>% 
  
  # fix variable leveling
  mutate(name = factor(name,
                       levels = c('scholarly article mentions',
                                  'news output mentions',
                                  'policy document mentions',
                                  'response time')
                       )
         )
```

Calculate number of articles
```{r}
# with 10 - 39 authors
desc %>% 
  filter(name == 'scholarly article mentions',
         size.bin == '10 - 19' |
           size.bin == '20 - 29' |
           size.bin == '30 - 39') %>% 
  ungroup() %>% 
  summarise(sum = sum(n))

# with 40+ authors
desc %>% 
  filter(name == 'scholarly article mentions',
         size.bin != '1 - 4',
         size.bin != '5 - 9',
         size.bin != '10 - 19',
         size.bin != '20 - 29',
         size.bin != '30 - 39') %>% 
  ungroup() %>% 
  summarise(sum = sum(n))
```

Plot (with small number of collaborations)
```{r}
ggplot(data = desc %>% 
         filter(size.bin == '1 - 4' |
                  size.bin == '5 - 9' |
                  size.bin == '10 - 19' |
                  size.bin == '20 - 29' |
                  size.bin == '30 - 39'),
       aes(x = size.bin,
           y = m,
           group = name)) +
  
  # create facet for different outcomes
  facet_wrap(~ name,
             scales = "free_y") +
  
  # plot raw means and standard errors
  geom_point() +
  geom_errorbar(aes(ymin = m - se,
                    ymax = m + se)) +
  geom_line(alpha = .2) +
  
  # improve aesthetics
  labs(x = '# of co-authors',
       y = "average value") +
  theme(axis.text.x = element_text(angle = 90, 
                                   hjust = 1,
                                   vjust = .5))
```

Plot (all)
```{r}
ggplot(data = desc,
       aes(x = size.bin,
           y = m,
           group = name)) +
  
  # create facet for different outcomes
  facet_wrap(~ name,
             scales = "free_y") +
  
  # plot raw means and standard errors
  geom_point() +
  geom_errorbar(aes(ymin = m - se,
                    ymax = m + se)) +
  geom_line(alpha = .2) +
  
  # improve aesthetics
  labs(x = '# of co-authors',
       y = "average value") +
  theme(axis.text.x = element_text(angle = 90, 
                                   hjust = 1,
                                   vjust = .5))
```

# Examination of big teams in research on ChatGPT
Calculate descriptive statistics
```{r}
# calculate 
desc <-
  DF %>% 
  
  # limit to terrorism papers
  filter(dataset == 'ai') %>% 
  
  # select relevant variables
  select(id, size.bin,
         cited_by_count : speed) %>% 
  
  # pivot longer for easier processing
  pivot_longer(cited_by_count : speed) %>% 
  
  # group
  group_by(size.bin, name) %>% 
  
  # summarise
  summarise(n = sum(!is.na(value)),
            m = mean(value,
                     na.rm = T),
            sd = sd(value,
                    na.rm = T),
            se = sd / sqrt(n)) %>% 
  
  # fix variable names
  mutate(name = 
           case_when(
             name == 'cited_by_count' ~ 'scholarly article mentions',
             name == 'news' ~ 'news output mentions',
             name == 'policy' ~ 'policy document mentions',
             name == 'speed' ~ 'response time'
             )
         ) %>% 
  
  # fix variable leveling
  mutate(name = factor(name,
                       levels = c('scholarly article mentions',
                                  'news output mentions',
                                  'policy document mentions',
                                  'response time')
                       )
         )
```

Calculate number of articles
```{r}
DF %>% 
  filter(dataset == 'ai') %>% 
  group_by(size.bin) %>% 
  summarise(n = n())
```

Plot (with small number of collaborations)
```{r}
ggplot(data = desc %>% 
         filter(size.bin == '1 - 4' |
                  size.bin == '5 - 9' |
                  size.bin == '10 - 19' |
                  size.bin == '20 - 29' |
                  size.bin == '30 - 39'),
       aes(x = size.bin,
           y = m,
           group = name)) +
  
  # create facet for different outcomes
  facet_wrap(~ name,
             scales = "free_y") +
  
  # plot raw means and standard errors
  geom_point() +
  geom_errorbar(aes(ymin = m - se,
                    ymax = m + se)) +
  geom_line(alpha = .2) +
  
  # improve aesthetics
  labs(x = '# of co-authors',
       y = "average value") +
  theme(axis.text.x = element_text(angle = 90, 
                                   hjust = 1,
                                   vjust = .5))
```

Plot (all)
```{r}
ggplot(data = desc,
       aes(x = size.bin,
           y = m,
           group = name)) +
  
  # create facet for different outcomes
  facet_wrap(~ name,
             scales = "free_y") +
  
  # plot raw means and standard errors
  geom_point() +
  geom_errorbar(aes(ymin = m - se,
                    ymax = m + se)) +
  geom_line(alpha = .2) +
  
  # improve aesthetics
  labs(x = '# of co-authors',
       y = "average value") +
  theme(axis.text.x = element_text(angle = 90, 
                                   hjust = 1,
                                   vjust = .5))
```
