---
title: "References for numbers reported in paper"
author: "Anonymized for peer review (NC)"
reviewer: "Anonymized for peer review (JT)"
output: word_document
editor_options: 
  chunk_output_type: console
---
This code compiles the numbers quoted in the paper.

# Setup
```{r libraries}
# load libraries
library('tidyverse')
library('here')

# specify directory
i_am('btmpact24e_paperrefs.Rmd')

# turn off scientific notation
options(scipen = 999)
```

Open combined and processed data
```{r}
DF <- 
  readRDS('data/combined/DF.full.combined.processed.Rds')
```

# Researchers are increasingly responding to urgent societal...
Publication dates of terrorism papers
```{r}
# calculate when terrorism papers were published
DF.terror.raw <- 
  readRDS('data/terrorism/btmpact24e_data_raw_terrorism.Rds') %>% 
  
  # select distinct records
  distinct(id,
           .keep_all = T) %>% 
  distinct(doi,
           .keep_all = T) %>% 
  
  # remove instances with no authorship info
  filter(!is.na(author))

# number of papers
DF.terror.raw %>% nrow()

# proportion published after 9/11
DF.terror.raw %>% 
  mutate(publication_date = as.Date(publication_date)) %>% 
  filter(publication_date > "2001-09-11") %>% 
  nrow / nrow(DF.terror.raw)

DF.terror.raw %>% 
  mutate(publication_date = as.Date(publication_date)) %>% 
  filter(publication_date > "2001-09-11") %>% 
  nrow

rm(DF.terror.raw)
```

Team sizes in terrorism research
```{r}
DF.terror <- 
  DF %>% 
  filter(dataset == 'terror')

# proportions
terror.prop <- 
  DF.terror %>% 
  group_by(size.bin) %>% 
  summarise(n.t = n()) %>% 
  mutate(prop.t = n.t / sum(n.t),
         prop.t = prop.t * 100,
         prop.t = round(prop.t, 2))

# proportion with more than 10 authors
DF.terror %>% 
  filter(authors.n > 9) %>% 
  nrow() / nrow(DF.terror)
```

Team size in COVID research
```{r}
DF.covid <- 
  DF %>% 
  filter(dataset == 'covid')

# proportions
covid.prop <- 
  DF.covid %>% 
  group_by(size.bin) %>% 
  summarise(n.c = n()) %>% 
  mutate(prop.c = n.c / sum(n.c),
         prop.c = prop.c * 100,
         prop.c = round(prop.c, 2))

# combine covid and terror proportions
prop <- left_join(terror.prop, covid.prop,
                  by = 'size.bin')

rm(terror.prop, covid.prop)

# calculate difference in proportions
prop <- 
  prop %>% 
  mutate(dif = prop.c - prop.t)

# calculate difference in big team effort
prop %>% 
  filter(size.bin != '1 - 4',
         size.bin != '5 - 9') %>% 
  summarise(prop.t = sum(prop.t),
            prop.c = sum(prop.c)) %>% 
  mutate(dif = prop.c - prop.t)

#rm(prop)
```

Proportion tests
```{r}
# fewer than 5 co-authors
## prop test
prop.test(x = c(prop[1, ]$n.t,
                prop[1, ]$n.c),
          n = c(DF %>% filter(dataset == 'terror') %>% nrow,
                DF %>% filter(dataset == 'covid') %>% nrow))

## total N
DF %>% filter(dataset == 'terror' |
                dataset == 'covid') %>%
  nrow

# 5 - 9 co-authors
## prop test
prop.test(x = c(prop[2, ]$n.t,
                prop[2, ]$n.c),
          n = c(DF %>% filter(dataset == 'terror') %>% nrow,
                DF %>% filter(dataset == 'covid') %>% nrow))

## total N
DF %>% filter(dataset == 'terror' |
                dataset == 'covid') %>%
  nrow

# 5 - 9 co-authors
## prop test
prop.test(x = c(DF %>% 
                  filter(dataset == 'terror',
                         size.bin != '1 - 4',
                         size.bin != '5 - 9') %>% 
                  nrow,
                DF %>% 
                  filter(dataset == 'covid',
                         size.bin != '1 - 4',
                         size.bin != '5 - 9') %>% 
                  nrow),
          n = c(DF %>% filter(dataset == 'terror') %>% nrow,
                DF %>% filter(dataset == 'covid') %>% nrow))

## total N
DF %>% filter(dataset == 'terror' |
                dataset == 'covid') %>%
  nrow
```

# When responding to the COVID-19 pandemic, bigger teams had ...
Compute summary statistics
```{r}
DF.covid.desc <- DF.covid %>% 
  group_by(size.bin) %>% 
  summarise(n = n(),
            
            cit.m = mean(cited_by_count, na.rm = T),
            cit.sd = sd(cited_by_count, na.rm = T),
            
            news.m = mean(news, na.rm = T),
            news.sd = sd(news, na.rm = T),
            
            policy.m = mean(policy, na.rm = T),
            policy.sd = sd(policy, na.rm = T),
            
            speed.m = mean(speed, na.rm = T),
            speed.sd = sd(speed, na.rm = T))
```

Compare team sizes of 1 - 4 to 10 - 19
```{r}
## citations
DF.covid.desc[DF.covid.desc$size.bin == '10 - 19', ]$cit.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$cit.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$cited_by_count,
  y = DF.covid[DF.covid$size.bin == '10 - 19', ]$cited_by_count,
  alternative = 'two.sided')

## news
DF.covid.desc[DF.covid.desc$size.bin == '10 - 19', ]$news.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$news.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$news,
  y = DF.covid[DF.covid$size.bin == '10 - 19', ]$news,
  alternative = 'two.sided')

## policy
DF.covid.desc[DF.covid.desc$size.bin == '10 - 19', ]$policy.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$policy.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$policy,
  y = DF.covid[DF.covid$size.bin == '10 - 19', ]$policy,
  alternative = 'two.sided')
```

Compare team sizes of 1 - 4 to 100+
```{r}
## citations
DF.covid.desc[DF.covid.desc$size.bin == '100 +', ]$cit.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$cit.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$cited_by_count,
  y = DF.covid[DF.covid$size.bin == '100 +', ]$cited_by_count,
  alternative = 'two.sided')

## news
DF.covid.desc[DF.covid.desc$size.bin == '100 +', ]$news.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$news.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$news,
  y = DF.covid[DF.covid$size.bin == '100 +', ]$news,
  alternative = 'two.sided')

## policy
DF.covid.desc[DF.covid.desc$size.bin == '100 +', ]$policy.m / 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$policy.m

wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$policy,
  y = DF.covid[DF.covid$size.bin == '100 +', ]$policy,
  alternative = 'two.sided')

## speed
DF.covid.desc[DF.covid.desc$size.bin == '100 +', ]$speed.m - 
  DF.covid.desc[DF.covid.desc$size.bin == '1 - 4', ]$speed.m

rm(DF.covid)
``` 

Speed analyses
```{r}
# 1- 4 to 10 - 19
wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$response_time,
  y = DF.covid[DF.covid$size.bin == '10 - 19', ]$response_time,
  alternative = 'two.sided')

# 1- 4 to 40 - 49
wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$response_time,
  y = DF.covid[DF.covid$size.bin == '40 - 49', ]$response_time,
  alternative = 'two.sided')

# 1- 4 to 100+
wilcox.test(
  x = DF.covid[DF.covid$size.bin == '1 - 4', ]$response_time,
  y = DF.covid[DF.covid$size.bin == '100 +', ]$response_time,
  alternative = 'two.sided')
```

# Looking forward: How are scientists ...
Open ChatGPT data
```{r}
DF.cgpt <- 
  DF %>% 
  filter(dataset == 'ai')

# total number of papers
nrow(DF.cgpt)

# papers per size bin
DF.cgpt %>% 
  group_by(size.bin) %>% 
  summarise(n = n()) %>% 
  mutate(prop = n / sum(n),
         prop = prop * 100,
         prop = round(prop, 2))

# number of published articles with 10+ authors
DF.cgpt %>% 
  filter(authors.n > 9) %>% 
  nrow() / nrow(DF.cgpt)

# impact descriptives
DF.cgpt.desc <- DF.cgpt %>% 
  group_by(size.bin) %>% 
  summarise(n = n(),
            
            cit.m = mean(cited_by_count, na.rm = T),
            cit.sd = sd(cited_by_count, na.rm = T),
            
            news.m = mean(news, na.rm = T),
            news.sd = sd(news, na.rm = T),
            
            policy.m = mean(policy, na.rm = T),
            policy.sd = sd(policy, na.rm = T),
            
            speed.m = mean(speed, na.rm = T),
            speed.sd = sd(speed, na.rm = T))
```

Compare team sizes of 1 - 4 to 10 - 19
```{r}
## citations
DF.cgpt.desc[DF.cgpt.desc$size.bin == '10 - 19', ]$cit.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$cit.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$cited_by_count,
  y = DF.cgpt[DF.cgpt$size.bin == '10 - 19', ]$cited_by_count,
  alternative = 'two.sided')

## news
DF.cgpt.desc[DF.cgpt.desc$size.bin == '10 - 19', ]$news.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$news.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$news,
  y = DF.cgpt[DF.cgpt$size.bin == '10 - 19', ]$news,
  alternative = 'two.sided')

## policy
DF.cgpt.desc[DF.cgpt.desc$size.bin == '10 - 19', ]$policy.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$policy.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$policy,
  y = DF.cgpt[DF.cgpt$size.bin == '10 - 19', ]$policy,
  alternative = 'two.sided')
```

Compare team sizes of 1 - 4 to 20 - 29
```{r}
## citations
DF.cgpt.desc[DF.cgpt.desc$size.bin == '20 - 29', ]$cit.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$cit.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$cited_by_count,
  y = DF.cgpt[DF.cgpt$size.bin == '20 - 29', ]$cited_by_count,
  alternative = 'two.sided')

## news
DF.cgpt.desc[DF.cgpt.desc$size.bin == '20 - 29', ]$news.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$news.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$news,
  y = DF.cgpt[DF.cgpt$size.bin == '20 - 29', ]$news,
  alternative = 'two.sided')

## policy
DF.cgpt.desc[DF.cgpt.desc$size.bin == '20 - 29', ]$policy.m / 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$policy.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$policy,
  y = DF.cgpt[DF.cgpt$size.bin == '20 - 29', ]$policy,
  alternative = 'two.sided')

# speed comparisons
DF.cgpt.desc[DF.cgpt.desc$size.bin == '5 - 9', ]$speed.m - 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$speed.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$response_time,
  y = DF.cgpt[DF.cgpt$size.bin == '5 - 9', ]$response_time,
  alternative = 'two.sided')

DF.cgpt.desc[DF.cgpt.desc$size.bin == '10 - 19', ]$speed.m - 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$speed.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$response_time,
  y = DF.cgpt[DF.cgpt$size.bin == '10 - 19', ]$response_time,
  alternative = 'two.sided')

DF.cgpt.desc[DF.cgpt.desc$size.bin == '30 - 39', ]$speed.m - 
  DF.cgpt.desc[DF.cgpt.desc$size.bin == '1 - 4', ]$speed.m

wilcox.test(
  x = DF.cgpt[DF.cgpt$size.bin == '1 - 4', ]$response_time,
  y = DF.cgpt[DF.cgpt$size.bin == '30 - 39', ]$response_time,
  alternative = 'two.sided')
```
